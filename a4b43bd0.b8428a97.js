(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{164:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return o})),t.d(n,"metadata",(function(){return s})),t.d(n,"rightToc",(function(){return l})),t.d(n,"default",(function(){return p}));var i=t(1),a=t(10),r=(t(0),t(179)),o={id:"extensions",title:"Extending Joern"},s={id:"extensions",title:"Extending Joern",description:"Joern provides a runtime extension mechanism that allows you to",source:"@site/docs/extensions.mdx",permalink:"/extensions",sidebar:"docs",previous:{title:"Syntax-Tree Queries",permalink:"/c-syntaxtree"},next:{title:"Glossary",permalink:"/glossary"}},l=[{value:"Installing the sample extension",id:"installing-the-sample-extension",children:[]},{value:"Importing into the IntelliJ IDE and running tests",id:"importing-into-the-intellij-ide-and-running-tests",children:[]},{value:"Adding dependencies",id:"adding-dependencies",children:[]},{value:"Extending the CPG schema",id:"extending-the-cpg-schema",children:[]}],c={rightToc:l};function p(e){var n=e.components,t=Object(a.a)(e,["components"]);return Object(r.b)("wrapper",Object(i.a)({},c,t,{components:n,mdxType:"MDXLayout"}),Object(r.b)("p",null,"Joern provides a runtime extension mechanism that allows you to\ndevelop custom analyzers on top of the platform. Extensions are\nprograms for the JVM that can be written in Java, Scala or\nKotlin. They can access the Code Property Praph via a query language\nand create new nodes, edges and properties via the DiffGraph\nAPI. Moreover, they can interface with Java libraries to accomplish\ndifferent tasks, like accessing the network or writing to the file\nsystem. Finally, even new node and edge types can be added to the\nschema, and the definition of existing node and edge types can be\nmodified."),Object(r.b)("h2",{id:"installing-the-sample-extension"},"Installing the sample extension"),Object(r.b)("p",null,"We provide a sample extension that you can use as a template. First,\nmake sure that dependencies are installed correctly:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Joern is installed in ",Object(r.b)("inlineCode",{parentName:"li"},"~/bin/joern")," (see\n",Object(r.b)("a",Object(i.a)({parentName:"li"},{href:"/installation"}),"Installation"),")"),Object(r.b)("li",{parentName:"ul"},"The Scala Build Tool (SBT) in any version (via your package manager)")),Object(r.b)("p",null,"Next, issue the following commands to install the sample extension."),Object(r.b)("pre",null,Object(r.b)("code",Object(i.a)({parentName:"pre"},{}),"git clone https://github.com/joernio/sample-extension\ncd sample-extension\n./install.sh\ncd ~/bin/joern/joern-cli\n./joern\n")),Object(r.b)("p",null,"On the joern shell, type ",Object(r.b)("inlineCode",{parentName:"p"},"run"),". You should see the extension in the\noverview:"),Object(r.b)("p",null,Object(r.b)("img",Object(i.a)({parentName:"p"},{src:"/img/run.png",alt:"Run output"}))),Object(r.b)("p",null,"To run the extension, type ",Object(r.b)("inlineCode",{parentName:"p"},"run.gitextension"),". You can also\ninspect/modify options passed to the plugin by typing\n",Object(r.b)("inlineCode",{parentName:"p"},"opts.gitextension.<TAB>"),"."),Object(r.b)("h2",{id:"importing-into-the-intellij-ide-and-running-tests"},"Importing into the IntelliJ IDE and running tests"),Object(r.b)("p",null,"Joern Extensions can be developed in an IDE and the process of\nimporting an extension may differ slightly from IDE to IDE. The\nfollowing instructions are for IntelliJ 2020.1.1."),Object(r.b)("p",null,'Choose "Open or Import" to import the project.'),Object(r.b)("p",null,Object(r.b)("img",Object(i.a)({parentName:"p"},{src:"/img/startscreen.png",alt:"IntelliJ start screen"}))),Object(r.b)("p",null,"Next, select the directory from the file selector. Assuming that your\nIntelliJ installation has support for ",Object(r.b)("inlineCode",{parentName:"p"},"sbt")," installed, the import is\nfully automated."),Object(r.b)("p",null,Object(r.b)("img",Object(i.a)({parentName:"p"},{src:"/img/select.png",alt:"Just select the project"}))),Object(r.b)("p",null,"Finally, navigate to ",Object(r.b)("inlineCode",{parentName:"p"},"src/test/scala/io/shiftleft/gitextension")," and\nclick on ",Object(r.b)("inlineCode",{parentName:"p"},"GitextentionTests"),". You can right-click on the class or the\nindividual tests to run them."),Object(r.b)("p",null,Object(r.b)("img",Object(i.a)({parentName:"p"},{src:"/img/runtests.png",alt:"Right click"}))),Object(r.b)("h2",{id:"adding-dependencies"},"Adding dependencies"),Object(r.b)("p",null,"You can add dependencies by modifying the variable\n",Object(r.b)("inlineCode",{parentName:"p"},"libraryDependencies")," in ",Object(r.b)("inlineCode",{parentName:"p"},"build.sbt"),":"),Object(r.b)("pre",null,Object(r.b)("code",Object(i.a)({parentName:"pre"},{}),'// build.sbt\nname := "joern-sample-extension"\nThisBuild/organization := "io.joern"\nThisBuild/scalaVersion := "2.13.0"\n\n...\n\nlibraryDependencies ++= Seq(\n   // Add your dependencies here\n  "org.eclipse.jgit" % "org.eclipse.jgit" % "5.7.0.202003110725-r",\n  // ...\n  "org.scalatest" %% "scalatest" % "3.1.1" % Test\n)\n\n...\n')),Object(r.b)("p",null,"If the dependency is not shipped with joern, please also make sure to\ncopy it to joern's ",Object(r.b)("inlineCode",{parentName:"p"},"lib")," directory on installation by editing\n",Object(r.b)("inlineCode",{parentName:"p"},"install.sh"),". (We may have already automated this step at the time of\nreading):"),Object(r.b)("pre",null,Object(r.b)("code",Object(i.a)({parentName:"pre"},{}),'// install.sh\n...\necho "Installing jars into: ${JAR_INSTALL_DIR}"\ncp target/universal/stage/lib/io.joern.joern-sample-extension-*.jar ${JAR_INSTALL_DIR}\ncp target/universal/stage/lib/org.eclipse.jgit.org.eclipse.jgit* ${JAR_INSTALL_DIR}\n// Copy any jars you need to be installed for the plugin into $JAR_INSTALL_DIR\ncp target/universal/stage/lib/... ${JAR_INSTALL_DIR}\n...\n')),Object(r.b)("h2",{id:"extending-the-cpg-schema"},"Extending the CPG schema"),Object(r.b)("p",null,"You can make additions to the CPG schema specification by placing\n",Object(r.b)("inlineCode",{parentName:"p"},".json")," files in ",Object(r.b)("inlineCode",{parentName:"p"},"schema/src/main/resources/schema/"),'. A sample schema\nextension is provided that adds an edge of type "FOO" that is valid\nfrom ',Object(r.b)("inlineCode",{parentName:"p"},"FILE")," nodes to ",Object(r.b)("inlineCode",{parentName:"p"},"METHOD")," nodes."),Object(r.b)("pre",null,Object(r.b)("code",Object(i.a)({parentName:"pre"},{}),'schema/src/main/resources/schema/ext.json\n\n{\n  "edgeTypes" : [\n    {"id" : 9000, "name": "FOO", "comment" : "Foo edge", "keys": []}\n  ],\n\n  "nodeTypes" : [\n      { "name" : "FILE", "outEdges" : [{"edgeName": "FOO", "inNodes": [{"name": "METHOD"}]}] }\n  ]\n}\n\n')))}p.isMDXComponent=!0},179:function(e,n,t){"use strict";t.d(n,"a",(function(){return d})),t.d(n,"b",(function(){return m}));var i=t(0),a=t.n(i);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,i,a=function(e,n){if(null==e)return{};var t,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)t=r[i],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)t=r[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var c=a.a.createContext({}),p=function(e){var n=a.a.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):s({},n,{},e)),t},d=function(e){var n=p(e.components);return a.a.createElement(c.Provider,{value:n},e.children)},b={inlineCode:"code",wrapper:function(e){var n=e.children;return a.a.createElement(a.a.Fragment,{},n)}},u=Object(i.forwardRef)((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,o=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(t),u=i,m=d["".concat(o,".").concat(u)]||d[u]||b[u]||r;return t?a.a.createElement(m,s({ref:n},c,{components:t})):a.a.createElement(m,s({ref:n},c))}));function m(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,o=new Array(r);o[0]=u;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var c=2;c<r;c++)o[c]=t[c];return a.a.createElement.apply(null,o)}return a.a.createElement.apply(null,t)}u.displayName="MDXCreateElement"}}]);